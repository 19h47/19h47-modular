"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=t=>t.charAt(0).toUpperCase()+t.slice(1),e=e=>e.reduce(((e,s)=>e+t(s))),s=t=>{t.mDestroy(),t.destroy()},i=async(t,e)=>{for(let s=0;s<t.length;s+=1)await e(t[s],s,t)};exports.default=class{constructor(t){this.app,this.modules=t.modules||[],this.currentModules={},this.activeModules={},this.newModules={},this.moduleId=0}async init(t,e){await this.collectModules(t,e),this.initModules(e)}async collectModules(s,o){const r=[...(o||document).querySelectorAll("*")].filter((t=>[...t.attributes].some((t=>t.name.startsWith("data-module")))));s&&!this.app&&(this.app=s),this.activeModules.app={app:this.app},await i(r,(async s=>{await i([...s.attributes],(async i=>{let{name:r,value:n}=i;if(r.startsWith("data-module")){const i=r.split("-").splice(2);let a=!1;const l=t(e(i));if(this.modules[l])a=!0;else{const t=await(async t=>(await import("@/scripts/modules/".concat(t))).default)(l);this.modules[l]=t,a=!0}if(a){const t={el:s,name:l,dataName:i.join("-")},e=new this.modules[l](t);let a=n;a||(this.moduleId+=1,a="m".concat(this.moduleId),s.setAttribute(r,a)),this.addActiveModule(l,a,e);const c="".concat(l,"-").concat(a);o?this.newModules[c]=e:this.currentModules[c]=e}}}))}))}initModules(t){Object.entries(this.currentModules).forEach((e=>{let[s,i]=e;if(t){const t=s.split("-"),e=t.shift(),o=t.pop();this.addActiveModule(e,o,i)}else this.initModule(i)}))}initModule(t){t.mInit(this.activeModules),t.init()}addActiveModule(t,e,s){this.activeModules[t]?Object.assign(this.activeModules[t],{[e]:s}):this.activeModules[t]={[e]:s}}async update(t){await this.init(this.app,t),Object.entries(this.currentModules).forEach((t=>{let[e,s]=t;return s.mUpdate(this.activeModules)})),Object.entries(this.newModules).forEach((t=>{let[e,s]=t;return this.initModule(s)})),Object.assign(this.currentModules,this.newModules)}destroy(t){t?this.destroyScope(t):this.destroyModules()}destroyScope(i){i.querySelectorAll("*").forEach((i=>{Array.from(i.attributes).forEach((i=>{if(i.name.startsWith("data-module")){const o=i.value,r=i.name.split("-").splice(2);let n="".concat(e(r),"-").concat(o),a=!1;this.currentModules[n]?a=!0:this.currentModules[t(n)]&&(n=t(n),a=!0),a&&(s(this.currentModules[n]),delete this.currentModules[n])}}))})),this.activeModules={},this.newModules={}}destroyModules(){Object.entries(this.currentModules).forEach((t=>{let[e,i]=t;return s(i)})),this.currentModules=[]}},exports.module=class{constructor(t){this.mAttr="data-"+t.dataName,this.mCaptureEvents=["mouseenter","mouseleave"],this.el=t.el}mInit(t){this.modules=t,this.mCheckEventTarget=this.mCheckEventTarget.bind(this),this.events&&Object.keys(this.events).forEach((t=>this.mAddEvent(t)))}mUpdate(t){this.modules=t}mDestroy(){this.events&&Object.keys(this.events).forEach((t=>this.mRemoveEvent(t)))}mAddEvent(t){const e=!!this.mCaptureEvents.includes(t);this.el.addEventListener(t,this.mCheckEventTarget,e)}mRemoveEvent(t){const e=!!this.mCaptureEvents.includes(t);this.el.removeEventListener(t,this.mCheckEventTarget,e)}mCheckEventTarget(t){const e=this.events[t.type];if("string"==typeof e)this[e](t);else{const s="["+this.mAttr+"]";let i=t.target;if(this.mCaptureEvents.includes(t.type))i.matches(s)&&this.mCallEventMethod(t,e,i);else for(;i&&i!==document&&(!i.matches(s)||"undefined"==this.mCallEventMethod(t,e,i));)i=i.parentNode}}mCallEventMethod(t,e,s){const i=s.getAttribute(this.mAttr);if(e.hasOwnProperty(i)){const o=e[i];t.hasOwnProperty("currentTarget")||Object.defineProperty(t,"currentTarget",{value:s}),t.hasOwnProperty("curTarget")||Object.defineProperty(t,"curTarget",{value:s}),this[o](t)}}$(t,e){const s=[t.indexOf("."),t.indexOf("#"),t.indexOf("[")].filter((t=>-1!=t));let i=!1,o=t,r="",n=this.el;return s.length&&(i=Math.min(...s),o=t.slice(0,i),r=t.slice(i)),"object"==typeof e&&(n=e),n.querySelectorAll("["+this.mAttr+"="+o+"]"+r)}parent(t,e){const s="["+this.mAttr+"="+t+"]";let i=e.parentNode;for(;i&&i!==document;){if(i.matches(s))return i;i=i.parentNode}}getData(t,e){return(e||this.el).getAttribute(this.mAttr+"-"+t)}setData(t,e,s){return(s||this.el).setAttribute(this.mAttr+"-"+t,e)}call(t,e,s,i){e&&!s&&(s=e,e=!1),this.modules[s]&&(i?this.modules[s][i]&&this.modules[s][i][t](e):Object.keys(this.modules[s]).forEach((i=>{this.modules[s][i][t](e)})))}on(t,e,s,i){this.modules[e]&&(i?this.modules[e][i].el.addEventListener(t,(t=>s(t))):Object.keys(this.modules[e]).forEach((i=>{this.modules[e][i].el.addEventListener(t,(t=>s(t)))})))}init(){}destroy(){}};
